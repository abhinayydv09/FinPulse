name: FinPulse Daily RSS

on:
  schedule:
    - cron: "0 2 * * *"    # 8 AM IST
  workflow_dispatch:

jobs:
  docker_run:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # Restore cached feeds.db (if exists)
      - name: Restore feeds.db from cache
        id: cache-feeds
        uses: actions/cache@v4
        with:
          path: data/feeds.db
          key: feeds-db-cache

      - uses: docker/setup-buildx-action@v3

      - name: Build Docker image
        run: docker build -t finpulse-bot .

      - name: Run bot
        run: |
          mkdir -p data
          docker run --rm \
            -e TELEGRAM_TOKEN="${TELEGRAM_TOKEN}" \
            -e TELEGRAM_CHANNEL="${TELEGRAM_CHANNEL}" \
            -v ${GITHUB_WORKSPACE}/data:/app/data \
            finpulse-bot

      # Save updated feeds.db back to cache
      - name: Save updated feeds.db to cache
        if: always()
        uses: actions/cache/save@v4
        with:
          path: data/feeds.db
          key: feeds-db-cache
